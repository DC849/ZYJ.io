<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>python项目</title>
<meta name="keywords" content="aqua theme, free website templates, one page, vertical scrolling, free layouts, CSS, HTML" />
<meta name="description" content="Aqua Theme is a free website template with vertical scrolling one page layout by templatemo.com" />
<link href="css/templatemo_style.css" rel="stylesheet" type="text/css" />

<script type='text/javascript' src='js/jquery.min.js'></script>
<script type='text/javascript' src='js/jquery.scrollTo-min.js'></script>
<script type='text/javascript' src='js/jquery.localscroll-min.js'></script>
<script type="text/javascript">
$(document).ready(function () {
$.localScroll();
});
</script> 

<link rel="stylesheet" href="css/slimbox2.css" type="text/css" media="screen" /> 
<script type="text/JavaScript" src="js/slimbox2.js"></script> 

</head>

<body>

<div id="background">

<div id="templatemo_wrapper">
	<div id="templatemo_header">
		<a href="http://cn.forwallpaper.com/"  class="templatemo_link"  ></a>
    </div> <!-- END of -->
    
    
    <div id="templatemo_main">
    	<div id="home" class="main_box">
        	<h1>python项目</h1>
        	<div class="col col_23">
            	
                <h2><em>项目背景</em></h2>
                <h4 align="justify">我们的选题灵感来源于大数据与电影行业的结合，如今数据捕获、存储和分析技术的持续进步正在积极影响着电影的方方面面。一部电影中，电影的口碑影评等会决定这部电影的推荐以及播放量和票房，将其应用到某些数学模型中，还可以达到预测电影获奖情况。因此，我们选取当下大部分人较为喜欢的香港电影作为我们的数据分析切入点，结合大数据的应用，以及参考现有的一些评分数据分析完成了我们的课题。</h4>
                <h4 align="justify">香港电影没落了吗？原因是什么？最近好多年，纯种的香港电影越来越少，越来越多的合拍片涌现街头。随着老一代的优秀导演演员的隐退，香港电影会淡出人们的视线以合拍片的形式出现吗？</h4>
                <div class="cleaner h30"></div>
                <h2>阶段性工作</h2>
                <h4>    华中师范大学 周雅静</h4>
          <ul class="tmo_list">
                    <li>对电影数据进行爬取，数据预处理中数据清洗与入库工作，使用pandas进行数据分析据和字段扩充工作，</li>
                    <li>用python语言编写可视化代码，借助了jieba,matplotlib和wordcloud等包，将收集到的数据进可视化展示并分析，得出结论。</li>
                    <li>数据库部分概念模型、关系模型的设计，使得python连接数据库对获取的数据方便进行管理与可视化。</li>
                    <li>网页制作与源码整理，将源码等整理放入html，并使用网页进行展示，对实现的结果进行整合编写技术文档。</li>
                </ul>
			</div>
            <div class="col col_13 no_margin_right">
            	<h2>关键技术</h2>
                    <h4>1.  利用Python写程序，调用豆瓣的api接口完成数据收集，最后将数据写入csv文件中</h4> 
                    <h4>2.  人工删除数据中一些脏数据，比如未上映的电影数据 ，非电影数据等等。并将最终经过筛选后的数据导入数据库</h4>
                    <h4>3.  使用pandas进行数据分析，利用现有的数据建立了很多新字段，比如演员的评分和导演的评分</h4>
                    <h4>4.  使用matplotlib可视化功能库进行图表绘制可视化展示</h4>
                <div class="cleaner h30"></div>
                
            	<h2>备注</h2>
                <ul class="twitter_post">
                    <li>开发环境：MySQL-8.0.16-MacOS 10.14-x86_64</li>
                    <li>Anaconda3-2018.12-Windows-x86_64</li>
                    <li>python 3.6</li>
                    <li>使用资源：matplotlib jieba numpy 等库</li>
                    <li> </li>
                </ul>
            </div>
            <div class="cleaner"></div>
            <div class="main_bottom">
	            <a href="#templatemo_header"></a>
			</div>
            <div class="cleaner"></div>
		</div> <!-- END of home -->
        
        <div id="about" class="main_box">
        	<h1>关键代码以及注释</h1>
            <img src="images/templatemo_image_02.jpg" alt="image" class="img_float_r" />
            <h4>爬虫部分</h4>
            <h4># -*- coding: utf-8 -*- 
                <p>from bs4 import BeautifulSoup</p>
                <p>from lxml import html</p>
                <p>import xml</p>
                <p>import requests</p>
                <p>import csv</p>

                <p>rank = 1</p>
                <p>def write_one_page(soup):</p>
                <p>    global rank</p>
                <p>def write_one_page(soup):</p>
                <p>    for k in </p>
                <p>        soup.find('div',class_='article').find_all('div',class_='info'):</p>
                <p>        name = k.find('div',class_='hd').find_all('span')#电影名字</p>
                <p>        score = k.find('div',class_='star').find_all('span')#分数</p>
                <p>        inq = k.find('p',class_='quote').find('span')#一句话简介</p>
                <p>        #抓取年份、国家</p>
                <p>        actor_infos_html = k.find(class_='bd')</p>
                <p>        #strip() 方法用于移除字符串头尾指定的字符（默认为空格）</p>
                <p>        actor_infos = actor_infos_html.find('p').get_text().strip().split('\n')</p>
                <p>        actor_infos1 = actor_infos[0].split('\xa0\xa0\xa0')</p>
                <p>        director = actor_infos1[0][3:]</p>
                <p>        role = actor_infos[1]</p>
                <p>        year_area = actor_infos[1].lstrip().split('\xa0/\xa0')</p>
                <p>        year = year_area[0]</p>
                <p>        country = year_area[1]</p>
                <p>        types = year_area[2]</p>
                <p></p>
                <p>        print(rank,name[0].string,score[1].string,inq.string,year,country,types)</p>
                <p>        #写csv       </p>
                <p>        write_to_file(rank,name[0].string,score[1].string,year,country,types,inq.string)</p>
                <p>    rank = rank+1</p>
                <p>def write_to_file(rank,name,score,year,country,types,quote):</p>
                <p>    out=open('Top_250_movie.csv', 'a',newline='',encoding='utf-8')</p>
                <p>    csv_write=csv.writer(out,dialect='excel')</p>
                <p>    csv_write.writerow([str(rank),str(name),str(score),str(year),str(country),str(types),str(quote)])</p>
                <p>    </p>
                <p>    '''</p>
                <p>    with open('Top_250_movie.csv', 'a',encoding='utf-8') as f:</p>
                <p>        #csv.write=csv.writer(f,dialext='excel')</p>
                <p>        f.writerow(str(rank)+';'+str(name)+';'+str(score)+';'+str(year)+';'+str(country)+';'+str(types)+';'+str(quote)+'\n')</p>
                <p>        f.close()</p>
                <p>    '''</p>
                <p>if __name__ == '__main__':</p>
                <p>    with open('Top_250_movie.csv', 'a',newline='',encoding='utf-8') as fp:</p>
                <p>            f=csv.writer(fp)</p>
                <p>            f.writerow(['rank','name','score','year','country','types','quote'])</p>
                <p>    for i in range(20):</p>
                <p>        a = i*25</p>
                <p>        url = "https://movie.douban.com/top250?start="+str(a)+"&filter="</p>
                <p>        f = requests.get(url)               </p>
                <p>        soup = BeautifulSoup(f.content, "lxml")</p>
                <p>        write_one_page(soup)</p>

                    
            </h4>

            <h4>可视化</h4>
            <h4># -*- coding: utf-8 -*- 
                <p>import matplotlib.pyplot as plt</p>
                <p>import csv</p>
                <p>import jieba</p>
                <p>import numpy</p>
                <p>from urllib.parse import quote,unquote</p>
                <p>from wordcloud import WordCloud,STOPWORDS</p>
                <p>from scipy.misc import imread</p>
                <p></p>
                <p>#得分与排名的情况</p>
                <p>rank = list()</p>
                <p>score = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    rank_str = [row['rank'] for row in reader ]</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    score_str = [row['score'] for row in reader ]</p>
                <p>for x in rank_str:</p>
                <p>    rank.append(int(x))</p>
                <p>for y in score_str:</p>
                <p>    score.append(float(y))</p>
                <p></p>
                <p>plt.gca().invert_yaxis()   #反转y轴</p>
                <p>plt.style.use('ggplot')</p>
                <p>plt.scatter(score,rank)</p>
                <p>plt.xlabel('score')</p>
                <p>plt.ylabel('rank')</p>
                <p>plt.title('得分和排名')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#得分与电影年份的关系</p>
                <p>year = list()</p>
                <p>score = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    year_str = [row['year'] for row in reader ]</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    score_str = [row['score'] for row in reader ]</p>
                <p>for x in year_str:</p>
                <p>    year.append(str(x))</p>
                <p>for y in score_str:</p>
                <p>    score.append(float(y))</p>
                <p></p>
                <p>plt.style.use('ggplot')</p>
                <p>plt.scatter(year,score)</p>
                <p>plt.xlabel('year')</p>
                <p>plt.ylabel('score')</p>
                <p>plt.title('得分和年份')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#得分与国家的关系</p>
                <p>country = list()</p>
                <p>score = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    country_str = [row['country'] for row in reader ]</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    score_str = [row['score'] for row in reader ]</p>
                <p>for x in country_str:</p>
                <p>    country.append(str(x))</p>
                <p>for y in score_str:</p>
                <p>    score.append(float(y))</p>
                <p></p>
                <p>plt.style.use('ggplot')</p>
                <p>plt.scatter(country,score)</p>
                <p>plt.xlabel('country')</p>
                <p>plt.ylabel('score')</p>
                <p>plt.title('得分和国家')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#电影类别与国家的关系</p>
                <p>country = list()</p>
                <p>types = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    country_str = [row['country'] for row in reader ]</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    types_str = [row['types'] for row in reader ]</p>
                <p>for x in country_str:</p>
                <p>    country.append(str(x))</p>
                <p>for y in types_str:</p>
                <p>    types.append(str(y))</p>
                <p></p>
                <p>plt.style.use('ggplot')</p>
                <p>plt.scatter(country,types)</p>
                <p>plt.xlabel('country')</p>
                <p>plt.ylabel('types')</p>
                <p>plt.title('类别和国家')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#电影国家排名情况</p>
                <p>country = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    country_str =' '.join([row['country'] for row in reader ])</p>
                <p>    country_list = country_str.split(' ')</p>
                <p>#统计</p>
                <p>country_set = set(country_list)   #放入set中去除重复数据，得到所有出现的国家</p>
                <p>for item in country_set:</p>
                <p>    country.append(country_list.count(item))#计数</p>
                <p>country_set = list(country_set)</p>
                <p></p>
                <p>#排序和画图</p>
                <p>plt.rcParams['savefig.dpi'] = 300 #图片像素</p>
                <p>plt.rcParams['figure.dpi'] = 200 #分辨率</p>
                <p>plt.xlabel('country')</p>
                <p>plt.ylabel('count')</p>
                <p>plt.title('国家分析')</p>
                <p>plt.tick_params(labelsize=7)   #字体设置</p>
                <p></p>
                <p>mydict = dict(zip(country,country_set))</p>
                <p>mydict_sort = sorted(mydict.items(), key=lambda e:e[0], reverse=True)</p>
                <p>mydict_sort = dict(mydict_sort)</p>
                <p>plt.bar(list(mydict_sort.values()), list(mydict_sort.keys()),color='lightblue')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#电影类型排名情况</p>
                <p>types = list()</p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    types_str =' '.join([row['types'] for row in reader ])</p>
                <p>    types_list = types_str.split(' ')</p>
                <p>#统计</p>
                <p>types_set = set(types_list)   #放入set中去除重复数据，得到所有出现的类型</p>
                <p>print (types_set)</p>
                <p>for item in types_set:</p>
                <p>    types.append(types_list.count(item))#计数</p>
                <p>types_set = list(types_set)</p>
                <p>types_set.remove('types')</p>
                <p>#排序和画图</p>
                <p>plt.rcParams['savefig.dpi'] = 300 #图片像素</p>
                <p>plt.rcParams['figure.dpi'] = 200 #分辨率</p>
                <p>plt.xlabel('types')</p>
                <p>plt.ylabel('count')</p>
                <p>plt.title('电影类型分析')</p>
                <p>plt.tick_params(labelsize=7)   #字体设置</p>
                <p></p>
                <p>mydict = dict(zip(types,types_set))</p>
                <p>mydict_sort = sorted(mydict.items(), key=lambda e:e[0], reverse=True)</p>
                <p>mydict_sort = dict(mydict_sort)</p>
                <p>plt.bar(list(mydict_sort.values()), list(mydict_sort.keys()),color='blue')</p>
                <p>plt.show()</p>
                <p></p>
                <p>#歌曲quote词云图</p>
                <p>text = " " </p>
                <p>with open('Top_250_movie.csv','r',encoding = "utf-8") as file:</p>
                <p>    reader = csv.DictReader(file)</p>
                <p>    quote_str =" ".join([row['quote'] for row in reader ])</p>
                <p>text = " ".join(jieba.lcut(str(quote_str)))</p>
                <p>cat = imread("cat.jpg")</p>
                <p>stopwords = set(STOPWORDS)</p>
                <p>stopwords.add("Pinocchio")</p>
                <p>w = WordCloud(font_path='C:\Windows\Fonts\simkai.ttf', background_color="white",width=1000, height=860,max_font_size=80,min_font_size=8,max_words=88,stopwords=stopwords,mask = cat)</p>
                <p>w.generate(text)</p>
                <p>w.to_file('quote.jpg')</p>


            </h4>
		  <div class="cleaner h40"></div>
            <div class="col col_23">
            	<h3><a href = "https://github.com/DC849/Src">点此进入github</h3> <!--写你自己的GitHub网址-->
			</div>
            
            <div class="cleaner"></div>
             <div class="main_bottom">
	            <a href="#templatemo_header"></a>
			</div>
		</div> <!-- END of about -->
        
        <div id="portfolio" class="main_box">
        	<h1> 运行截图</h1>
        	<ul id="gallery">
                <li><a href="images/portfolio/01.jpg" rel="lightbox[portfolio]"><img src="images/portfolio/01-s.jpg" alt="image 1" /></a></li>
                <li><a href="images/portfolio/02.jpg" rel="lightbox[portfolio]"><img src="images/portfolio/02-s.jpg" alt="image 2" /></a></li>
                <li><a href="images/portfolio/03.jpg" rel="lightbox[portfolio]"><img src="images/portfolio/03-s.jpg" alt="image 3" /></a></li>
                
			</ul>

            <div class="col col_23">
                <h3><a href="https://dc849.github.io/douban_movie.io/">点此观看网页效果</h3> <!--写你自己的GitHub网址-->
            </div>
            <div class="cleaner"></div>
            <div class="main_bottom">
	            <a href="#templatemo_header"></a>
			</div>
            <div class="cleaner"></div>
		</div> <!-- END of portfolio --> 

</div>
</body>
<script type='text/javascript' src='js/logging.js'></script>
</html>
